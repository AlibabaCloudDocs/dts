# 创建Oracle数据订阅通道

通过数据订阅功能，您可以实时订阅源库的增量数据，轻松帮助业务实现轻量级缓存更新、业务异步解耦、含ETL逻辑的数据实时同步等场景。本文为您介绍如何创建Oracle数据订阅通道。

-   自建Oracle数据库的版本为9i、10g、11g或12c版本。
-   自建Oracle数据库已开启Supplemental Logging，且要求supplemental\_log\_data\_pk，supplemental\_log\_data\_ui已开启，详情请参见[Supplemental Logging](https://docs.oracle.com/database/121/SUTIL/GUID-D857AF96-AC24-4CA1-B620-8EA3DF30D72E.htm#SUTIL1582)。
-   自建Oracle数据库已开启ARCHIVELOG（归档模式），设置合理的归档日志保持周期且归档日志能够被访问，详情请参见[ARCHIVELOG](https://docs.oracle.com/database/121/ADMIN/archredo.htm#ADMIN008)。

## 注意事项

-   由于使用gh-ost或pt-online-schema-change等类似工具执行在线DDL变更不会被订阅到，客户端在将消费到的数据写入目标表时可能会因为表结构不一致而导致写入失败。
-   如果订阅的源数据库还处于其他任务中（例如该数据库还存在于某个正在运行的数据迁移任务中），您可能会订阅到订阅对象以外的数据，此类场景中，您需要手动在订阅客户端中过滤掉不需要的数据。

## 准备工作

登录待订阅的Oracle数据库，创建用于数据订阅的数据库账号并授授予DBA权限。

**说明：** 如果不允许授予DBA权限，您可以参照以下内容为数据库账号授予更精细化的权限。



## 操作步骤

1.  购买数据订阅通道，详情请参见[购买流程](/cn.zh-CN/快速入门/购买流程.md)。

    **说明：** 购买时选择**订阅实例类型**为**Oracle**并选择源实例所属的地域。

2.  登录[数据传输控制台](https://dts.console.aliyun.com/)。

3.  在左侧导航栏，单击**数据订阅**。

4.  在数据订阅列表页面上方，选择订阅通道所属地域。

    ![选择地域](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1428919951/p51699.png)

5.  定位至已购买的数据订阅通道，单击**配置订阅通道**。

6.  配置数据订阅的源库信息和网络类型。

    ![配置源库信息和网络类型](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6887248951/p65169.png)

    |类别|配置|说明|
    |:-|:-|:-|
    |无|订阅名称|DTS会自动生成一个订阅名称，建议配置具有业务意义的名称（无唯一性要求），便于后续识别。|
    |源库信息|实例类型|根据源实例的类型进行选择，本文以**ECS上的自建数据库**为例介绍配置流程。 **说明：** 当自建数据库为其他实例类型时，您还需要执行相应的准备工作，详情请参见[准备工作概览](/cn.zh-CN/准备工作/准备工作概览.md)。 |
    |数据库类型|固定为Oracle，不可变更。|
    |实例地区|购买数据订阅通道时选择的**源实例地域**，不可变更。|
    |ECS实例ID|选择自建Oracle数据库所属的ECS实例ID。|
    |端口|填入自建Oracle数据库的服务端口。|
    |SID|填入自建Oracle数据库的SID信息。|
    |数据库账号|填入自建Oracle的数据库账号。 **说明：** 创建及授权方法请参见[准备工作](#section_m8w_cwr_57d)。 |
    |数据库密码|填入该数据库账号对应的密码。|
    |消费网络类型|无|设置数据订阅实例所属的网络类型。 **说明：**

    -   建议配置同部署数据订阅客户端的[ECS](https://help.aliyun.com/document_detail/25367.html)实例属于同一网络。例如ECS是专有网络，那么此处的网络类型选择为专有网络并指定ECS所属的**专有网络**和**虚拟交换机**。
    -   通过内网地址进行数据订阅时，网络延迟最小。
     -   **经典网络**

如果设置为**经典网络**，无需其他配置。关于经典网络介绍请参见[经典网络](https://help.aliyun.com/document_detail/61651.html#h2-url-2)。

    -   **专有网络**

如果设置为**专有网络**，您还需要选择**专有网络**和**虚拟交换机**。关于专有网络介绍请参见[专有网络](https://help.aliyun.com/document_detail/61651.html#h2-url-1)。 |

7.  上述配置完成后，单击**授权白名单并进入下一步**，详细说明请参见下表。

    |源库实例类型|说明|
    |------|--|
    |ECS上的自建数据库|此步骤会将DTS服务器的IP地址自动添加至ECS实例的内网入方向规则中，用于保障DTS服务器能够正常连接源实例。|
    |    -   通过专线/VPN网关/智能网关接入的自建数据库
    -   无公网IP:Port的数据库（通过数据库网关DG接入）
    -   有公网IP的自建数据库
|如果源库具备白名单安全设置，您需要将DTS服务器的IP地址加入至自建数据库的白名单安全设置中，详情请参见[迁移、同步或订阅本地数据库时需添加的IP白名单](/cn.zh-CN/准备工作/迁移、同步或订阅本地数据库时需添加的IP白名单.md)。|

8.  配置需要订阅的数据类型和订阅对象。

    ![选择数据类型和订阅对象](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4777298951/p97678.png)

    |配置|说明|
    |:-|:-|
    |需要订阅的数据类型|    -   **数据更新**

订阅已选择对象的增量数据更新，包含数据的INSERT、DELETE和UPDATE操作。

    -   **结构更新**

订阅整个实例所有对象的结构创建、删除及修改，您需要使用数据订阅客户端过滤所需的数据。

**说明：**

    -   如果选择整个库作为订阅对象，那么该库中新增对象的增量数据也可以被订阅到。
    -   如果选择某个表作为订阅对象，那么只有这个表的增量数据可以被订阅到。此时如果需要加入一个新的表作为订阅对象，您需要将其加入至订阅对象中，详情请参见[修改订阅对象](/cn.zh-CN/数据订阅/数据订阅（新版）/修改订阅对象.md)。 |
    |订阅对象|在订阅对象框中将想要订阅的对象选中，单击![向右小箭头](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8502659951/p40698.png)图标将其移动到已选择对象框。

**说明：** 订阅对象支持选择的粒度为库、表。 |

9.  上述配置完成后，单击页面右下角的**保存并预检查**。

    **说明：**

    -   在订阅任务正式启动之前，会先进行预检查。只有预检查通过后，才能成功启动订阅任务。
    -   如果预检查失败，单击具体检查项后的![提示](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8502659951/p47468.png)，查看失败详情。根据提示修复问题后，重新进行预检查。
10. 在预检查对话框中显示**预检查通过**后，关闭预检查对话框。

    配置完成后，数据订阅通道会进入初始化阶段，该阶段一般会持续1分钟左右。初始化完成后即可进行新增消费组与消费订阅数据的操作。


1.  [新增消费组](/cn.zh-CN/数据订阅/数据订阅（新版）/新增消费组.md)
2.  [使用Kafka客户端消费订阅数据](/cn.zh-CN/数据订阅/数据订阅（新版）/使用Kafka客户端消费订阅数据.md)

